<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>第九曼荼羅 - The 9th Mandala -</title>
    <style>
        :root {
            /* 初期テーマカラー：深紫（無明） */
            --theme-color: #6a0dad;
            --theme-glow: rgba(106, 13, 173, 0.5);
            --bg-black: #020202;
        }

        body {
            background-color: var(--bg-black);
            /* 背景をより暗くし、中心からテーマカラーが微かに滲むように調整 */
            background-image: radial-gradient(circle at center, rgba(0,0,0,0) 0%, var(--bg-black) 80%),
                              radial-gradient(circle at center, var(--theme-glow) 0%, transparent 60%);
            color: var(--theme-color);
            font-family: 'Yu Mincho', 'MS Mincho', serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            transition: color 1s ease, background-image 1s ease;
        }

        /* ヘッダーエリア */
        #header {
            text-align: center;
            margin-bottom: 30px;
            z-index: 10;
            text-shadow: 0 0 15px var(--theme-glow);
        }

        h1 { font-size: 2.5rem; letter-spacing: 0.3rem; margin: 0; transition: all 1s ease; }
        .stats-container { font-size: 1.2rem; margin-top: 15px; border-top: 1px solid var(--theme-color); padding-top: 15px; }
        #virtue { font-family: monospace; font-size: 1.5rem; }

        /* 曼荼羅 */
        #mandala-stage {
            position: relative;
            width: 450px;
            height: 450px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-bottom: 30px;
        }

        .mandala-layer {
            position: absolute;
            border: 2px solid var(--theme-color);
            border-radius: 50%;
            opacity: 0.7;
            box-shadow: 0 0 10px var(--theme-glow), inset 0 0 5px var(--theme-glow);
            transition: all 1s ease, animation-duration 2s ease;
        }

        #layer1 { width: 420px; height: 420px; border-style: double; border-width: 4px; animation: rotate 60s linear infinite; }
        #layer2 { width: 340px; height: 340px; border-style: dashed; animation: rotate 45s linear infinite reverse; }
        #layer3 { width: 240px; height: 240px; border-style: dotted; border-width: 3px; animation: rotate 30s linear infinite; }
        
        #core {
            width: 120px;
            height: 120px;
            /* 中心もテーマカラーで発光 */
            background: radial-gradient(circle, var(--theme-color) 20%, transparent 80%);
            border: 2px solid var(--theme-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            text-shadow: 0 0 5px var(--theme-color);
            font-weight: bold;
            font-size: 3rem;
            z-index: 5;
            box-shadow: 0 0 40px var(--theme-glow), inset 0 0 20px var(--theme-glow);
            transition: all 0.3s ease, background 1s ease, box-shadow 1s ease, border-color 1s ease;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* クリックエフェクト */
        .virtue-pop {
            position: absolute;
            color: var(--theme-color);
            font-weight: bold;
            font-family: monospace;
            text-shadow: 0 0 5px var(--theme-glow);
            pointer-events: none;
            animation: riseFade 1s ease-out forwards;
            z-index: 100;
        }

        @keyframes riseFade {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-60px) scale(1.5); }
        }

        /* ショップエリア */
        #shop {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 80%;
            max-width: 600px;
        }

        .upgrade-card {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--theme-color);
            box-shadow: inset 0 0 10px var(--theme-glow);
            padding: 15px;
            text-align: center;
            transition: 0.3s;
        }

        button {
            background: var(--theme-color);
            color: #000;
            border: none;
            padding: 10px 15px;
            margin-top: 15px;
            cursor: pointer;
            font-family: serif;
            font-weight: bold;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px var(--theme-glow);
        }

        button:hover:not(:disabled) {
            filter: brightness(1.2);
            box-shadow: 0 0 20px var(--theme-glow);
        }

        button:disabled {
            background: #333;
            color: #666;
            box-shadow: none;
            cursor: not-allowed;
            border: 1px solid #444;
        }

        .count { font-size: 0.9rem; color: rgba(255,255,255,0.7); display: block; margin-top: 5px; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="header">
        <h1 id="rank-name">第零曼荼羅：無明</h1>
        <div class="stats-container">
            徳：<span id="virtue">0</span><br>
            <small>毎秒の自動功徳: <span id="per-sec">0</span></small>
        </div>
    </div>

    <div id="mandala-stage" onclick="clickMandala(event)">
        <div id="layer1" class="mandala-layer"></div>
        <div id="layer2" class="mandala-layer"></div>
        <div id="layer3" class="mandala-layer"></div>
        <div id="core">唵</div>
    </div>

    <div id="shop">
        <div class="upgrade-card">
            <strong>修行僧の招集</strong>
            <span class="count" id="monk-count">Lv.0</span>
            <button id="btn-monk" onclick="buyMonk()">徳を捧げる</button>
        </div>
        <div class="upgrade-card">
            <strong>自動詠唱の儀</strong>
            <span class="count" id="chant-count">Lv.0</span>
            <button id="btn-chant" onclick="buyChant()">徳を捧げる</button>
        </div>
    </div>

    <script>
        let virtue = 0;
        let monkCount = 0;
        let chantPower = 0;
        let rank = 0;

        const rankData = [
            { name: "第零曼荼羅：無明", color: "#6a0dad" }, // 紫
            { name: "第一曼荼羅：胎蔵界", color: "#4b0082" }, // インディゴ
            { name: "第二曼荼羅：金剛界", color: "#0000ff" }, // 青
            { name: "第三曼荼羅：阿弥陀", color: "#008000" }, // 緑
            { name: "第四曼荼羅：蓮華", color: "#adff2f" }, // 黄緑
            { name: "第五曼荼羅：虚空", color: "#ffff00" }, // 黄
            { name: "第六曼荼羅：寂静", color: "#ffd700" }, // 黄金
            { name: "第七曼荼羅：遍照", color: "#ffa500" }, // オレンジ
            { name: "第八曼荼羅：解脱", color: "#ff4500" }, // 赤橙
            { name: "第九曼荼羅：不可説不可説転", color: "#ff0000" }  // 赤
        ];

        function clickMandala(e) {
            const gain = 1 + (monkCount * 2);
            virtue += gain;
            
            const pop = document.createElement('div');
            pop.className = 'virtue-pop';
            pop.innerText = `+${gain.toLocaleString()}`;
            pop.style.left = `${e.clientX}px`;
            pop.style.top = `${e.clientY}px`;
            document.body.appendChild(pop);
            setTimeout(() => pop.remove(), 1000);

            const core = document.getElementById('core');
            core.style.transform = 'scale(1.15)';
            setTimeout(() => core.style.transform = 'scale(1)', 100);

            updateDisplay();
        }

        function buyMonk() {
            let cost = Math.floor(15 * Math.pow(1.25, monkCount));
            if (virtue >= cost) {
                virtue -= cost;
                monkCount++;
                updateDisplay();
            }
        }

        function buyChant() {
            let cost = Math.floor(100 * Math.pow(1.25, chantPower/5));
            if (virtue >= cost) {
                virtue -= cost;
                chantPower += 5;
                updateDisplay();
            }
        }

        function updateDisplay() {
            document.getElementById('virtue').innerText = Math.floor(virtue).toLocaleString();
            document.getElementById('per-sec').innerText = chantPower.toLocaleString();
            
            let monkCost = Math.floor(15 * Math.pow(1.25, monkCount));
            document.getElementById('monk-count').innerText = `Lv.${monkCount} (クリック +${1 + monkCount * 2})`;
            document.getElementById('btn-monk').innerText = `徳 ${monkCost.toLocaleString()} を捧げる`;
            document.getElementById('btn-monk').disabled = virtue < monkCost;

            let chantCost = Math.floor(100 * Math.pow(1.25, chantPower/5));
            document.getElementById('chant-count').innerText = `Lv.${chantPower/5} (毎秒 +${chantPower})`;
            document.getElementById('btn-chant').innerText = `徳 ${chantCost.toLocaleString()} を捧げる`;
            document.getElementById('btn-chant').disabled = virtue < chantCost;

            // ランクアップ判定 (100の累乗)
            let nextRankThreshold = Math.pow(100, rank + 1);
            if (virtue >= nextRankThreshold && rank < 9) {
                rank++;
                applyRankTheme(rank);
            }
        }

        // テーマカラー適用関数
        function applyRankTheme(currentRank) {
            const data = rankData[currentRank];
            document.getElementById('rank-name').innerText = data.name;
            
            // CSS変数を更新して全体のテーマカラーを変更
            const root = document.documentElement;
            root.style.setProperty('--theme-color', data.color);
            root.style.setProperty('--theme-glow', `${data.color}80`); // 透明度50%のグロー色を作成

            // 曼荼羅の回転速度を加速
            const baseSpeed = 60;
            document.getElementById('layer1').style.animationDuration = `${baseSpeed / (currentRank + 1)}s`;
            document.getElementById('layer2').style.animationDuration = `${baseSpeed * 0.75 / (currentRank + 1)}s`;
            document.getElementById('layer3').style.animationDuration = `${baseSpeed * 0.5 / (currentRank + 1)}s`;
        }

        setInterval(() => {
            if (chantPower > 0) {
                virtue += chantPower / 10;
                updateDisplay();
            }
        }, 100);
        
        // 初期化
        updateDisplay();
    </script>
</body>
</html>
