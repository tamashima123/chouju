<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>第九曼荼羅 - The 9th Mandala -</title>
    <style>
        :root {
            --gold: #d4af37;
            --dark-red: #4a0404;
            --bg-black: #050505;
        }

        body {
            background-color: var(--bg-black);
            background-image: radial-gradient(circle, #1a1a1a 0%, #050505 100%);
            color: var(--gold);
            font-family: 'Yu Mincho', 'MS Mincho', serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            /* テキスト選択を完全に禁止 */
            user-select: none;
            -webkit-user-select: none;
        }

        /* ヘッダーエリア */
        #header {
            text-align: center;
            margin-bottom: 20px;
            z-index: 10;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        h1 { font-size: 2.5rem; letter-spacing: 0.5rem; margin: 0; }
        .stats-container { font-size: 1.2rem; margin-top: 10px; border-top: 1px solid var(--gold); padding-top: 10px; }

        /* 曼荼羅（クリック対象） */
        #mandala-stage {
            position: relative;
            width: 450px;
            height: 450px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .mandala-layer {
            position: absolute;
            border: 1px solid var(--gold);
            border-radius: 50%;
            opacity: 0.6;
            transition: all 0.5s ease;
        }

        /* 各層の回転速度を変えて複雑さを出す */
        #layer1 { width: 400px; height: 400px; border-style: double; border-width: 3px; animation: rotate 30s linear infinite; }
        #layer2 { width: 320px; height: 320px; border-style: dashed; animation: rotate 20s linear infinite reverse; }
        #layer3 { width: 220px; height: 220px; border-style: double; animation: rotate 15s linear infinite; }
        
        #core {
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, var(--gold) 0%, transparent 70%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: black;
            font-weight: bold;
            font-size: 2rem;
            z-index: 5;
            box-shadow: 0 0 30px var(--gold);
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* クリックエフェクト */
        .virtue-pop {
            position: absolute;
            color: white;
            font-weight: bold;
            pointer-events: none;
            animation: riseFade 1s ease-out forwards;
            z-index: 100;
        }

        @keyframes riseFade {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-50px); }
        }

        /* ショップエリア */
        #shop {
            margin-top: 40px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 80%;
            max-width: 600px;
        }

        .upgrade-card {
            background: rgba(212, 175, 55, 0.05);
            border: 1px solid var(--gold);
            padding: 15px;
            text-align: center;
            transition: 0.3s;
        }

        .upgrade-card:hover:not(.disabled) {
            background: rgba(212, 175, 55, 0.2);
        }

        button {
            background: var(--gold);
            color: black;
            border: none;
            padding: 8px 15px;
            margin-top: 10px;
            cursor: pointer;
            font-family: serif;
            font-weight: bold;
            width: 100%;
        }

        button:disabled {
            background: #444;
            color: #888;
            cursor: not-allowed;
        }

        .count { font-size: 0.8rem; color: #888; display: block; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="header">
        <h1 id="rank-name">第一曼荼羅：胎蔵界</h1>
        <div class="stats-container">
            徳：<span id="virtue">0</span><br>
            <small>毎秒の自動功徳: <span id="per-sec">0</span></small>
        </div>
    </div>

    <div id="mandala-stage" onclick="clickMandala(event)">
        <div id="layer1" class="mandala-layer"></div>
        <div id="layer2" class="mandala-layer"></div>
        <div id="layer3" class="mandala-layer"></div>
        <div id="core">唵</div>
    </div>

    <div id="shop">
        <div class="upgrade-card" id="card-monk">
            <strong>修行僧の招集</strong>
            <span class="count" id="monk-count">Lv.0 (クリック+1)</span>
            <button id="btn-monk" onclick="buyMonk()">徳 15 を捧げる</button>
        </div>
        <div class="upgrade-card" id="card-chant">
            <strong>自動詠唱の儀</strong>
            <span class="count" id="chant-count">Lv.0 (毎秒+1)</span>
            <button id="btn-chant" onclick="buyChant()">徳 100 を捧げる</button>
        </div>
    </div>

    <script>
        let virtue = 0;
        let monkCount = 0;
        let chantPower = 0;
        let rank = 1;

        const rankNames = [
            "第一曼荼羅：胎蔵界", "第二曼荼羅：金剛界", "第三曼荼羅：阿弥陀", 
            "第四曼荼羅：蓮華", "第五曼荼羅：虚空", "第六曼荼羅：寂静", 
            "第七曼荼羅：遍照", "第八曼荼羅：解脱", "第九曼荼羅：第九曼荼羅"
        ];

        function clickMandala(e) {
            const gain = 1 + monkCount;
            virtue += gain;
            
            // ポップアップエフェクト
            const pop = document.createElement('div');
            pop.className = 'virtue-pop';
            pop.innerText = `+${gain}`;
            pop.style.left = `${e.clientX}px`;
            pop.style.top = `${e.clientY}px`;
            document.body.appendChild(pop);
            setTimeout(() => pop.remove(), 1000);

            // クリック時のコアの鼓動
            const core = document.getElementById('core');
            core.style.transform = 'scale(1.2)';
            setTimeout(() => core.style.transform = 'scale(1)', 50);

            updateDisplay();
        }

        function buyMonk() {
            let cost = Math.floor(15 * Math.pow(1.15, monkCount));
            if (virtue >= cost) {
                virtue -= cost;
                monkCount++;
                updateDisplay();
            }
        }

        function buyChant() {
            let cost = Math.floor(100 * Math.pow(1.15, chantPower));
            if (virtue >= cost) {
                virtue -= cost;
                chantPower++;
                updateDisplay();
            }
        }

        function updateDisplay() {
            document.getElementById('virtue').innerText = Math.floor(virtue);
            document.getElementById('per-sec').innerText = chantPower;
            
            // 修行僧
            let monkCost = Math.floor(15 * Math.pow(1.15, monkCount));
            document.getElementById('monk-count').innerText = `Lv.${monkCount} (クリック +${1 + monkCount})`;
            document.getElementById('btn-monk').innerText = `徳 ${monkCost} を捧げる`;
            document.getElementById('btn-monk').disabled = virtue < monkCost;

            // 念仏
            let chantCost = Math.floor(100 * Math.pow(1.15, chantPower));
            document.getElementById('chant-count').innerText = `Lv.${chantPower} (毎秒 +${chantPower})`;
            document.getElementById('btn-chant').innerText = `徳 ${chantCost} を捧げる`;
            document.getElementById('btn-chant').disabled = virtue < chantCost;

            // ランクアップ
            let nextRankThreshold = Math.pow(10, rank + 1);
            if (virtue >= nextRankThreshold && rank < 9) {
                rank++;
                document.getElementById('rank-name').innerText = rankNames[rank-1];
                // 進化演出：色が少しずつ赤くなる
                const intensity = rank * 20;
                document.getElementById('core').style.boxShadow = `0 0 ${intensity}px var(--gold)`;
                if (rank > 5) {
                    document.documentElement.style.setProperty('--gold', '#ff4500'); // オレンジ〜赤へ
                }
            }
        }

        // 自動加算（0.1秒ごとに計算）
        setInterval(() => {
            if (chantPower > 0) {
                virtue += chantPower / 10;
                updateDisplay();
            }
        }, 100);
    </script>
</body>
</html>
