<script>
        // --- 時計処理 ---
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').textContent = now.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        }
        setInterval(updateClock, 1000); updateClock();

        // --- お知らせ処理 (news.txt 読み込み版) ---
        async function loadNews() {
            const list = document.getElementById('news-list');
            try {
                // ファイル名を 'news.txt' に変更
                // ?v=... をつけることで、キャッシュ(古い内容)が残るのを防ぎます
                const response = await fetch('news.txt?v=' + new Date().getTime());
                
                if (!response.ok) throw new Error("news.txtが見つかりません");
                
                const text = await response.text();
                const lines = text.trim().split('\n');
                list.innerHTML = ''; // クリア

                lines.forEach(line => {
                    if (!line.trim()) return;
                    const parts = line.split(/\s+(.*)/); // 最初の空白で分割
                    const date = parts[0] || '';
                    const content = parts[1] || '';
                    if (date && content) {
                        const li = document.createElement('li');
                        li.className = 'news-item';
                        li.innerHTML = `<span class="news-date">${date}</span><span class="news-content">${content}</span>`;
                        list.appendChild(li);
                    }
                });
            } catch (error) {
                console.error(error);
                list.innerHTML = '<li class="news-item" style="color:#ffcccc;">お知らせを読み込めませんでした。<br><small>※news.txtがindex.htmlと同じ場所にありますか？</small></li>';
            }
        }
        loadNews();

        // --- おみくじ処理 ---
        const omikujiData = [
            { unsei: "大吉", kotoba: "笑う門には福来たる。今日は最高の笑顔で。" },
            { unsei: "中吉", kotoba: "焦らずとも機は熟す。ゆったりと構えよ。" },
            { unsei: "小吉", kotoba: "小さな幸せを見つけられそう。道端の花に目を向けて。" },
            { unsei: "吉", kotoba: "平穏無事こそが最大の幸福なり。" },
            { unsei: "末吉", kotoba: "終わりよければ全て良し。最後まで気を抜かずに。" },
            { unsei: "凶", kotoba: "今日は静かに過ごすが吉。無理は禁物。" },
            { unsei: "大吉", kotoba: "思いがけない幸運が舞い込む予感。素直な心で。" }
        ];
        function drawOmikuji() {
            const resultBox = document.getElementById('omikuji-result');
            const resultUnsei = document.getElementById('result-unsei');
            const resultKotoba = document.getElementById('result-kotoba');
            const btn = document.querySelector('.omikuji-btn');
            if (resultBox.classList.contains('show')) { resultBox.classList.remove('show'); return; }
            btn.animate([{ transform: 'rotate(0deg)' }, { transform: 'rotate(-15deg)' }, { transform: 'rotate(15deg)' }, { transform: 'rotate(0deg)' }], { duration: 300 });
            const randomIndex = Math.floor(Math.random() * omikujiData.length);
            const result = omikujiData[randomIndex];
            resultUnsei.textContent = result.unsei; resultKotoba.textContent = result.kotoba;
            setTimeout(() => { resultBox.classList.add('show'); }, 100);
            setTimeout(() => { resultBox.classList.remove('show'); }, 5000);
        }

        // --- ブックマーク処理 ---
        const bookmarkList = document.getElementById('bookmark-list');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const nameInput = document.getElementById('bm-name');
        const urlInput = document.getElementById('bm-url');
        const deleteBtn = document.getElementById('btn-delete');
        let editingIndex = -1;
        let bookmarks = JSON.parse(localStorage.getItem('myBookmarks')) || [];

        function renderBookmarks() {
            const items = bookmarkList.querySelectorAll('.bookmark-item');
            items.forEach(e => e.remove());
            bookmarks.forEach((bm, index) => {
                const a = document.createElement('a');
                a.href = bm.url; a.className = 'bookmark-item'; a.textContent = bm.name; a.target = "_blank"; 
                a.addEventListener('contextmenu', function(e) { e.preventDefault(); openEditModal(index); });
                const addBtn = bookmarkList.querySelector('.add-btn');
                bookmarkList.insertBefore(a, addBtn);
            });
        }
        function openAddModal() {
            editingIndex = -1; modalTitle.textContent = "ショートカットを追加";
            nameInput.value = ''; urlInput.value = ''; deleteBtn.style.display = 'none';
            modal.style.display = 'flex'; nameInput.focus();
        }
        function openEditModal(index) {
            editingIndex = index; modalTitle.textContent = "ショートカットを編集";
            nameInput.value = bookmarks[index].name; urlInput.value = bookmarks[index].url;
            deleteBtn.style.display = 'inline-block'; modal.style.display = 'flex';
        }
        function saveBookmark() {
            const name = nameInput.value; let url = urlInput.value;
            if(!name || !url) { alert('名前とURLを入力してください'); return; }
            if (!url.startsWith('http://') && !url.startsWith('https://')) { url = 'https://' + url; }
            if (editingIndex === -1) { bookmarks.push({ name: name, url: url }); } else { bookmarks[editingIndex] = { name: name, url: url }; }
            saveToStorage(); renderBookmarks(); closeModal();
        }
        function deleteCurrentBookmark() {
            if(editingIndex !== -1 && confirm('本当に削除しますか？')) {
                bookmarks.splice(editingIndex, 1); saveToStorage(); renderBookmarks(); closeModal();
            }
        }
        function saveToStorage() { localStorage.setItem('myBookmarks', JSON.stringify(bookmarks)); }
        function closeModal() { modal.style.display = 'none'; }
        renderBookmarks();
    </script>
